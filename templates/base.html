<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}Майстерня{% endblock %}</title>
    <style>
        /* ── theme tokens ── */
        :root {
            --sidebar-w: 56px;
            --sidebar-exp: 210px;
            --ease: cubic-bezier(0.4, 0, 0.2, 1);
            --radius: 12px;
            --radius-sm: 8px;
            font-family: "Inter", "Segoe UI", -apple-system, BlinkMacSystemFont, Helvetica, Arial, sans-serif;
        }

        /* ── dark (default) ── */
        [data-theme="dark"] {
            --bg: #06090f;
            --bg-sub: #0c1220;
            --surface: rgba(14, 21, 38, 0.7);
            --surface-hover: rgba(22, 32, 56, 0.8);
            --sidebar-bg: rgba(14, 21, 38, 0.7);
            --border: rgba(84, 246, 199, 0.08);
            --border-active: rgba(84, 246, 199, 0.25);
            --accent: #54f6c7;
            --accent-secondary: #38bdf8;
            --accent-dim: rgba(84, 246, 199, 0.1);
            --accent-glow: rgba(84, 246, 199, 0.15);
            --text: #e2edf8;
            --text-secondary: #94a3b8;
            --text-muted: #64748b;
            --shadow-card: 0 4px 24px rgba(0, 0, 0, 0.3), 0 0 0 1px var(--border);
            --shadow-elevated: 0 8px 40px rgba(0, 0, 0, 0.45);
            --shadow-sidebar: none;
            --btn-bg: linear-gradient(135deg, var(--accent), var(--accent-secondary));
            --btn-text: #06090f;
            --input-bg: rgba(14, 21, 38, 0.6);
            color-scheme: dark;
        }

        /* ── light ── */
        [data-theme="light"] {
            --bg: #f0f2f8;
            --bg-sub: #e8eaf2;
            --surface: rgba(255, 255, 255, 0.92);
            --surface-hover: rgba(255, 255, 255, 1);
            --sidebar-bg: rgba(255, 255, 255, 0.97);
            --border: rgba(15, 23, 42, 0.1);
            --border-active: rgba(13, 147, 115, 0.35);
            --accent: #059669;
            --accent-secondary: #0284c7;
            --accent-dim: rgba(5, 150, 105, 0.07);
            --accent-glow: rgba(5, 150, 105, 0.12);
            --text: #0f172a;
            --text-secondary: #334155;
            --text-muted: #94a3b8;
            --shadow-card: 0 1px 3px rgba(15, 23, 42, 0.04), 0 4px 16px rgba(15, 23, 42, 0.06);
            --shadow-elevated: 0 8px 32px rgba(15, 23, 42, 0.1), 0 2px 6px rgba(15, 23, 42, 0.04);
            --shadow-sidebar: 2px 0 20px rgba(15, 23, 42, 0.06);
            --btn-bg: linear-gradient(135deg, #059669, #0284c7);
            --btn-text: #fff;
            --input-bg: rgba(255, 255, 255, 0.85);
            color-scheme: light;
        }

        *, *::before, *::after {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            min-height: 100vh;
            background: var(--bg);
            color: var(--text);
            transition: background 0.35s var(--ease), color 0.35s var(--ease);
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        /* subtle background mesh */
        body::before {
            content: '';
            position: fixed;
            inset: 0;
            pointer-events: none;
            z-index: -1;
            transition: background 0.5s var(--ease);
        }

        [data-theme="dark"] body::before {
            background: radial-gradient(ellipse 80% 60% at 20% 10%, rgba(84, 246, 199, 0.08), transparent),
            radial-gradient(ellipse 60% 50% at 80% 90%, rgba(56, 189, 248, 0.05), transparent);
        }

        [data-theme="light"] body::before {
            background: radial-gradient(ellipse 70% 50% at 10% 0%, rgba(5, 150, 105, 0.06), transparent),
            radial-gradient(ellipse 50% 40% at 90% 100%, rgba(2, 132, 199, 0.05), transparent),
            radial-gradient(ellipse 40% 30% at 50% 50%, rgba(139, 92, 246, 0.03), transparent);
        }

        /* ── sidebar ── */
        .sidebar {
            position: fixed;
            top: 0;
            left: 0;
            bottom: 0;
            width: var(--sidebar-w);
            background: var(--sidebar-bg);
            -webkit-backdrop-filter: blur(32px) saturate(1.6);
            backdrop-filter: blur(32px) saturate(1.6);
            border-right: 1px solid var(--border);
            box-shadow: var(--shadow-sidebar);
            display: flex;
            flex-direction: column;
            z-index: 100;
            transition: width 0.3s var(--ease), background 0.35s var(--ease), box-shadow 0.35s var(--ease);
            overflow: hidden;
        }

        body.sidebar-pinned .sidebar {
            width: var(--sidebar-exp);
        }

        .sidebar-header {
            height: 56px;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 0 14px;
            flex-shrink: 0;
            border-bottom: 1px solid var(--border);
        }

        body.sidebar-pinned .sidebar-header {
            justify-content: space-between;
        }

        .sidebar-brand {
            display: none;
            align-items: center;
            gap: 10px;
            text-decoration: none;
            color: var(--text);
            overflow: hidden;
        }

        body.sidebar-pinned .sidebar-brand {
            display: flex;
        }

        .sidebar-logo {
            width: 26px;
            height: 26px;
            flex-shrink: 0;
            border-radius: 8px;
            background: var(--btn-bg);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 800;
            font-size: 13px;
            color: var(--btn-text);
            letter-spacing: -0.02em;
            box-shadow: 0 2px 8px var(--accent-glow);
        }

        .sidebar-brand span {
            white-space: nowrap;
            font-weight: 700;
            font-size: 0.85rem;
            letter-spacing: 0.08em;
            text-transform: uppercase;
            opacity: 0;
            transition: opacity 0.2s ease 0.05s;
        }

        body.sidebar-pinned .sidebar-brand span {
            opacity: 1;
        }

        /* nav */
        .sidebar-nav {
            flex: 1;
            display: flex;
            flex-direction: column;
            padding: 8px;
            gap: 2px;
            list-style: none;
            overflow-y: auto;
            overflow-x: hidden;
        }

        .sidebar-nav::-webkit-scrollbar {
            width: 0;
        }

        .sidebar-nav .spacer {
            flex: 1;
        }

        .sidebar-nav a {
            display: flex;
            align-items: center;
            gap: 12px;
            height: 40px;
            padding: 0 8px;
            border-radius: var(--radius-sm);
            color: var(--text-secondary);
            text-decoration: none;
            font-size: 0.82rem;
            font-weight: 500;
            white-space: nowrap;
            transition: background 0.15s ease, color 0.15s ease, box-shadow 0.15s ease;
            border: none;
            background: none;
            cursor: pointer;
            width: 100%;
            position: relative;
        }

        .sidebar-nav a:hover,
        .sidebar-nav a.active {
            background: var(--accent-dim);
            color: var(--accent);
            box-shadow: inset 0 0 0 1px var(--accent-dim);
        }

        .nav-label {
            opacity: 0;
            transition: opacity 0.2s ease 0.05s;
        }

        body.sidebar-pinned .nav-label {
            opacity: 1;
        }

        .nav-icon {
            width: 20px;
            height: 20px;
            flex-shrink: 0;
            fill: none;
            stroke: currentColor;
            stroke-width: 1.75;
            stroke-linecap: round;
            stroke-linejoin: round;
            transition: stroke 0.15s ease;
        }

        /* sidebar buttons */
        .sidebar-toggle-btn,
        .theme-toggle-btn {
            width: 28px;
            height: 28px;
            padding: 0;
            flex-shrink: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 6px;
            border: none;
            background: none;
            color: var(--text-muted);
            cursor: pointer;
            transition: background 0.15s ease, color 0.15s ease;
        }

        .sidebar-toggle-btn:hover,
        .theme-toggle-btn:hover {
            background: var(--accent-dim);
            color: var(--accent);
        }

        .sidebar-toggle-btn .nav-icon,
        .theme-toggle-btn .nav-icon {
            width: 16px;
            height: 16px;
        }

        .collapse-icon-close {
            display: none;
        }

        body.sidebar-pinned .collapse-icon-open {
            display: none;
        }

        body.sidebar-pinned .collapse-icon-close {
            display: block;
        }

        .theme-icon-moon {
            display: none;
        }

        [data-theme="light"] .theme-icon-sun {
            display: none;
        }

        [data-theme="light"] .theme-icon-moon {
            display: block;
        }

        /* theme toggle in nav */
        .sidebar-nav .theme-row {
            display: flex;
            align-items: center;
            gap: 12px;
            height: 40px;
            padding: 0 8px;
            border-radius: var(--radius-sm);
            cursor: pointer;
            border: none;
            background: none;
            color: var(--text-secondary);
            font-size: 0.82rem;
            font-weight: 500;
            white-space: nowrap;
            width: 100%;
            transition: background 0.15s ease, color 0.15s ease;
        }

        .sidebar-nav .theme-row:hover {
            background: var(--accent-dim);
            color: var(--accent);
        }

        .sidebar-nav .theme-row .nav-icon {
            width: 20px;
            height: 20px;
        }

        /* submenu */
        .submenu {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        body:not(.sidebar-pinned) .submenu { display: none; }

        .submenu li a {
            padding-left: 40px;
            height: 36px;
            font-size: 0.78rem;
        }
        .submenu li a .nav-icon {
            width: 16px;
            height: 16px;
        }

        /* ── main ── */
        .app-main {
            margin-left: var(--sidebar-w);
            min-height: 100vh;
            transition: margin-left 0.3s var(--ease);
        }

        body.sidebar-pinned .app-main {
            margin-left: var(--sidebar-exp);
        }

        main {
            padding: 2rem clamp(1.5rem, 5vw, 3rem);
            max-width: 1200px;
            margin: 0 auto;
            width: 100%;
        }

        /* ── shared components ── */
        .card {
            background: var(--surface);
            -webkit-backdrop-filter: blur(20px);
            backdrop-filter: blur(20px);
            border-radius: var(--radius);
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            box-shadow: var(--shadow-card);
            border: 1px solid var(--border);
            transition: box-shadow 0.25s ease, border-color 0.25s ease, background 0.35s var(--ease);
        }

        .card:hover {
            box-shadow: var(--shadow-elevated);
            border-color: var(--border-active);
        }

        .card h2 {
            margin-top: 0;
        }

        .muted {
            color: var(--text-muted);
        }

        .meta-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 0.5rem 1rem;
            padding: 0;
            margin: 1rem 0;
            list-style: none;
        }

        .meta-grid li {
            background: var(--accent-dim);
            border-radius: var(--radius-sm);
            padding: 0.75rem;
            border: 1px solid var(--border);
            transition: background 0.2s ease;
        }

        button.button, a.button {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 0.4rem;
            padding: 0.6rem 1.1rem;
            border-radius: var(--radius-sm);
            background: var(--btn-bg);
            color: var(--btn-text);
            text-decoration: none;
            font-weight: 600;
            font-size: 0.85rem;
            letter-spacing: 0.03em;
            text-transform: uppercase;
            border: none;
            cursor: pointer;
            box-shadow: 0 2px 8px var(--accent-glow);
            transition: box-shadow 0.2s ease, transform 0.15s ease;
        }

        button.button:hover, a.button:hover {
            box-shadow: 0 4px 16px var(--accent-glow);
            transform: translateY(-1px);
        }

        button.button:active, a.button:active {
            transform: translateY(0);
        }

        a.button.ghost {
            background: transparent;
            color: var(--text);
            border: 1px solid var(--border-active);
            box-shadow: none;
        }

        a.button.ghost:hover {
            background: var(--accent-dim);
            box-shadow: none;
            transform: none;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th, td {
            padding: 0.75rem;
            text-align: left;
            border-bottom: 1px solid var(--border);
        }

        th {
            font-size: 0.78rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.06em;
            color: var(--text-muted);
        }

        tr {
            transition: background 0.12s ease;
        }

        tr:hover td {
            background: var(--accent-dim);
        }

        .parameters {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 0.75rem;
            padding: 0;
            margin: 0;
            list-style: none;
        }

        .parameters li {
            border: 1px solid var(--border);
            border-radius: var(--radius-sm);
            padding: 0.75rem;
            background: var(--surface);
            transition: border-color 0.2s ease;
        }

        .parameters li:hover {
            border-color: var(--border-active);
        }

        form.search {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1.25rem;
        }

        form.search input {
            flex: 1;
            padding: 0.65rem 0.85rem;
            border: 1px solid var(--border);
            border-radius: var(--radius-sm);
            background: var(--input-bg);
            -webkit-backdrop-filter: blur(8px);
            backdrop-filter: blur(8px);
            color: var(--text);
            font-size: 0.875rem;
            transition: border-color 0.2s ease, box-shadow 0.2s ease;
            outline: none;
        }

        form.search input:focus {
            border-color: var(--accent);
            box-shadow: 0 0 0 3px var(--accent-dim);
        }

        form.search button {
            border: none;
            background: var(--btn-bg);
            color: var(--btn-text);
            padding: 0.65rem 1.25rem;
            border-radius: var(--radius-sm);
            cursor: pointer;
            font-weight: 600;
            font-size: 0.85rem;
            letter-spacing: 0.05em;
        }

        /* links */
        a {
            color: var(--accent);
        }

        /* scrollbar */
        ::-webkit-scrollbar {
            width: 6px;
        }

        ::-webkit-scrollbar-track {
            background: transparent;
        }

        ::-webkit-scrollbar-thumb {
            background: var(--text-muted);
            border-radius: 3px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--text-secondary);
        }

        /* ── toasts ── */
        .toast-container {
            position: fixed;
            bottom: 1.5rem;
            right: 1.5rem;
            z-index: 9999;
            display: flex;
            flex-direction: column-reverse;
            gap: 0.5rem;
            pointer-events: none;
            max-width: 380px;
        }

        .toast {
            pointer-events: auto;
            display: flex;
            align-items: flex-start;
            gap: 0.6rem;
            padding: 0.85rem 1rem;
            border-radius: var(--radius-sm);
            background: var(--surface);
            -webkit-backdrop-filter: blur(20px);
            backdrop-filter: blur(20px);
            border: 1px solid var(--border);
            box-shadow: var(--shadow-elevated);
            color: var(--text);
            font-size: 0.85rem;
            line-height: 1.4;
            animation: toast-in 0.35s var(--ease) forwards;
        }

        .toast.toast-out {
            animation: toast-out 0.3s var(--ease) forwards;
        }

        .toast-icon {
            width: 18px;
            height: 18px;
            flex-shrink: 0;
            margin-top: 1px;
        }

        .toast-body {
            flex: 1;
        }

        .toast-close {
            background: none;
            border: none;
            color: var(--text-muted);
            cursor: pointer;
            padding: 2px;
            line-height: 1;
            font-size: 1rem;
            flex-shrink: 0;
            transition: color 0.15s ease;
        }

        .toast-close:hover {
            color: var(--text);
        }

        .toast.toast-success {
            border-color: rgba(34, 197, 94, 0.3);
        }

        .toast.toast-success .toast-icon {
            color: #22c55e;
        }

        .toast.toast-error {
            border-color: rgba(239, 68, 68, 0.3);
        }

        .toast.toast-error .toast-icon {
            color: #ef4444;
        }

        .toast.toast-warning {
            border-color: rgba(245, 158, 11, 0.3);
        }

        .toast.toast-warning .toast-icon {
            color: #f59e0b;
        }

        .toast.toast-info {
            border-color: rgba(56, 189, 248, 0.3);
        }

        .toast.toast-info .toast-icon {
            color: #38bdf8;
        }

        @keyframes toast-in {
            from {
                opacity: 0;
                transform: translateX(30px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        @keyframes toast-out {
            from {
                opacity: 1;
                transform: translateX(0);
            }
            to {
                opacity: 0;
                transform: translateX(30px);
            }
        }

        /* ── mobile ── */
        .mobile-header {
            display: none;
        }

        .mobile-overlay {
            display: none;
        }

        @media (max-width: 768px) {
            .sidebar {
                width: var(--sidebar-exp);
                transform: translateX(-100%);
                transition: transform 0.3s var(--ease), background 0.35s var(--ease);
            }

            .sidebar .nav-label {
                opacity: 1;
            }

            .sidebar .sidebar-brand {
                display: flex;
            }

            .sidebar .sidebar-brand span {
                opacity: 1;
            }

            .sidebar-toggle-btn {
                display: none;
            }

            body.mobile-open .sidebar {
                transform: translateX(0);
            }

            .mobile-overlay {
                display: block;
                position: fixed;
                inset: 0;
                z-index: 99;
                opacity: 0;
                pointer-events: none;
                transition: opacity 0.3s var(--ease);
                -webkit-backdrop-filter: blur(6px);
                backdrop-filter: blur(6px);
            }

            [data-theme="dark"] .mobile-overlay {
                background: rgba(0, 0, 0, 0.5);
            }

            [data-theme="light"] .mobile-overlay {
                background: rgba(15, 23, 42, 0.2);
            }

            body.mobile-open .mobile-overlay {
                opacity: 1;
                pointer-events: auto;
            }

            .mobile-header {
                display: flex;
                align-items: center;
                gap: 12px;
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                height: 48px;
                padding: 0 12px;
                background: var(--sidebar-bg);
                -webkit-backdrop-filter: blur(32px) saturate(1.6);
                backdrop-filter: blur(32px) saturate(1.6);
                border-bottom: 1px solid var(--border);
                box-shadow: var(--shadow-sidebar);
                z-index: 90;
                transition: background 0.35s var(--ease), box-shadow 0.35s var(--ease);
            }

            .mobile-burger {
                width: 36px;
                height: 36px;
                border: none;
                background: none;
                cursor: pointer;
                display: flex;
                align-items: center;
                justify-content: center;
                border-radius: var(--radius-sm);
                color: var(--text-secondary);
                transition: color 0.15s ease, background 0.15s ease;
                flex-shrink: 0;
            }

            .mobile-burger:hover {
                background: var(--accent-dim);
                color: var(--accent);
            }

            .mobile-header-brand {
                display: flex;
                align-items: center;
                gap: 8px;
                font-weight: 700;
                font-size: 0.85rem;
                letter-spacing: 0.08em;
                text-transform: uppercase;
                color: var(--text);
                text-decoration: none;
            }

            .mobile-theme-toggle {
                margin-left: auto;
            }

            .app-main {
                margin-left: 0;
                padding-top: 48px;
            }

            body.sidebar-pinned .app-main {
                margin-left: 0;
            }
        }
    </style>
    {% block head %}{% endblock %}
</head>
<body class="{% block body_class %}{% endblock %}">

{% block site_header %}
    <div class="mobile-overlay" data-overlay></div>

    <header class="mobile-header">
        <button class="mobile-burger" type="button" data-mobile-toggle aria-label="Menu">
            <svg class="nav-icon" viewBox="0 0 24 24">
                <line x1="3" y1="6" x2="21" y2="6"/>
                <line x1="3" y1="12" x2="21" y2="12"/>
                <line x1="3" y1="18" x2="21" y2="18"/>
            </svg>
        </button>
        <a href="{% url 'home' %}" class="mobile-header-brand">
            <div class="sidebar-logo">М</div>
            <span>Майстерня</span>
        </a>
        <button class="theme-toggle-btn mobile-theme-toggle" type="button" data-theme-toggle aria-label="Toggle theme">
            <svg class="nav-icon theme-icon-sun" viewBox="0 0 24 24">
                <circle cx="12" cy="12" r="5"/>
                <line x1="12" y1="1" x2="12" y2="3"/>
                <line x1="12" y1="21" x2="12" y2="23"/>
                <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/>
                <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/>
                <line x1="1" y1="12" x2="3" y2="12"/>
                <line x1="21" y1="12" x2="23" y2="12"/>
                <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/>
                <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/>
            </svg>
            <svg class="nav-icon theme-icon-moon" viewBox="0 0 24 24">
                <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/>
            </svg>
        </button>
    </header>

    <aside class="sidebar">
        <div class="sidebar-header">
            <a href="{% url 'home' %}" class="sidebar-brand">
                <div class="sidebar-logo">М</div>
                <span>Майстерня</span>
            </a>
            <button class="sidebar-toggle-btn" type="button" data-pin-toggle>
                <svg class="nav-icon collapse-icon-open" viewBox="0 0 24 24">
                    <polyline points="13 17 18 12 13 7"/>
                    <polyline points="6 17 11 12 6 7"/>
                </svg>
                <svg class="nav-icon collapse-icon-close" viewBox="0 0 24 24">
                    <polyline points="11 17 6 12 11 7"/>
                    <polyline points="18 17 13 12 18 7"/>
                </svg>
            </button>
        </div>
        <ul class="sidebar-nav">
            <li><a href="{% url 'home' %}">
                <svg class="nav-icon" viewBox="0 0 24 24">
                    <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/>
                    <polyline points="9 22 9 12 15 12 15 22"/>
                </svg>
                <span class="nav-label">Головна</span></a></li>
            <li><a href="{% url 'documentation:documentation_page' %}">
                <svg class="nav-icon" viewBox="0 0 24 24">
                    <path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"/>
                    <path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"/>
                </svg>
                <span class="nav-label">Документація</span></a></li>
            {% if user.is_superuser or "майстер" in user_groups or "командир майстерні" in user_groups %}
                <li>
                    <a href="{% url 'equipment_accounting:equipment_list' %}">
                        <svg class="nav-icon" viewBox="0 0 24 24">
                            <circle cx="12" cy="12" r="3"/>
                            <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 1 1-2.83 2.83l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-4 0v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 1 1-2.83-2.83l.06-.06A1.65 1.65 0 0 0 4.68 15a1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1 0-4h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 1 1 2.83-2.83l.06.06A1.65 1.65 0 0 0 9 4.68a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 4 0v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 1 1 2.83 2.83l-.06.06A1.65 1.65 0 0 0 19.4 9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 0 4h-.09a1.65 1.65 0 0 0-1.51 1z"/>
                        </svg>
                        <span class="nav-label">Облік майна</span>
                    </a>
                    <ul class="submenu" id="submenu-equipment">
                        <li><a href="{% url 'equipment_accounting:equipment_list' %}?tab=drones">
                            <svg class="nav-icon" viewBox="0 0 24 24"><path d="M12 2L2 7l10 5 10-5-10-5z"/><path d="M2 17l10 5 10-5"/><path d="M2 12l10 5 10-5"/></svg>
                            <span class="nav-label">БПЛА</span></a></li>
                        <li><a href="{% url 'equipment_accounting:equipment_list' %}?tab=components">
                            <svg class="nav-icon" viewBox="0 0 24 24"><rect x="4" y="4" width="16" height="16" rx="2" ry="2"/><rect x="9" y="9" width="6" height="6"/><line x1="9" y1="1" x2="9" y2="4"/><line x1="15" y1="1" x2="15" y2="4"/><line x1="9" y1="20" x2="9" y2="23"/><line x1="15" y1="20" x2="15" y2="23"/><line x1="20" y1="9" x2="23" y2="9"/><line x1="20" y1="14" x2="23" y2="14"/><line x1="1" y1="9" x2="4" y2="9"/><line x1="1" y1="14" x2="4" y2="14"/></svg>
                            <span class="nav-label">Комплектуючі</span></a></li>
                        <li><a href="{% url 'equipment_accounting:equipment_list' %}?tab=templates">
                            <svg class="nav-icon" viewBox="0 0 24 24"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/></svg>
                            <span class="nav-label">Шаблони</span></a></li>
                    </ul>
                </li>
                <li><a href="{% url 'expense_log:expense_list' %}">
                    <svg class="nav-icon" viewBox="0 0 24 24">
                        <line x1="12" y1="1" x2="12" y2="23"/>
                        <path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/>
                    </svg>
                    <span class="nav-label">Фінанси</span></a></li>
            {% endif %}
            {% if user.is_superuser %}
                <li><a href="{% url 'admin:index' %}">
                    <svg class="nav-icon" viewBox="0 0 24 24">
                        <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/>
                    </svg>
                    <span class="nav-label">Адмінка</span></a></li>
            {% endif %}
            <li class="spacer"></li>
            <li>
                <button class="theme-row" type="button" data-theme-toggle aria-label="Toggle theme">
                    <svg class="nav-icon theme-icon-sun" viewBox="0 0 24 24">
                        <circle cx="12" cy="12" r="5"/>
                        <line x1="12" y1="1" x2="12" y2="3"/>
                        <line x1="12" y1="21" x2="12" y2="23"/>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/>
                        <line x1="1" y1="12" x2="3" y2="12"/>
                        <line x1="21" y1="12" x2="23" y2="12"/>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/>
                    </svg>
                    <svg class="nav-icon theme-icon-moon" viewBox="0 0 24 24">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/>
                    </svg>
                    <span class="nav-label">Тема</span>
                </button>
            </li>
            {% if user.is_authenticated %}
                <li><a href="{% url 'user_management:profile' %}">
                    <svg class="nav-icon" viewBox="0 0 24 24">
                        <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
                        <circle cx="12" cy="7" r="4"/>
                    </svg>
                    <span class="nav-label">Профіль</span></a></li>
                <li><a href="{% url 'account_logout' %}">
                    <svg class="nav-icon" viewBox="0 0 24 24">
                        <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/>
                        <polyline points="16 17 21 12 16 7"/>
                        <line x1="21" y1="12" x2="9" y2="12"/>
                    </svg>
                    <span class="nav-label">Вихід</span></a></li>
            {% else %}
                <li><a href="{% url 'account_login' %}">
                    <svg class="nav-icon" viewBox="0 0 24 24">
                        <path d="M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4"/>
                        <polyline points="10 17 15 12 10 7"/>
                        <line x1="15" y1="12" x2="3" y2="12"/>
                    </svg>
                    <span class="nav-label">Вхід</span></a></li>
            {% endif %}
        </ul>
    </aside>
{% endblock %}

<div class="app-main">
    <main>
        {% block content %}{% endblock %}
    </main>
</div>

{% if messages %}
    <div class="toast-container" id="toast-container">
        {% for message in messages %}
            <div class="toast toast-{{ message.tags|default:'info' }}" role="alert">
                <svg class="toast-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                     stroke-linecap="round" stroke-linejoin="round">
                    {% if 'success' in message.tags %}
                        <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/>
                        <polyline points="22 4 12 14.01 9 11.01"/>
                    {% elif 'error' in message.tags %}
                        <circle cx="12" cy="12" r="10"/>
                        <line x1="15" y1="9" x2="9" y2="15"/>
                        <line x1="9" y1="9" x2="15" y2="15"/>
                    {% elif 'warning' in message.tags %}
                        <path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"/>
                        <line x1="12" y1="9" x2="12" y2="13"/>
                        <line x1="12" y1="17" x2="12.01" y2="17"/>
                    {% else %}
                        <circle cx="12" cy="12" r="10"/>
                        <line x1="12" y1="16" x2="12" y2="12"/>
                        <line x1="12" y1="8" x2="12.01" y2="8"/>
                    {% endif %}
                </svg>
                <span class="toast-body">{{ message }}</span>
                <button class="toast-close" type="button" aria-label="Close">&times;</button>
            </div>
        {% endfor %}
    </div>
{% endif %}

<script>
    (function () {
        var body = document.body;
        var html = document.documentElement;
        var SIDEBAR_KEY = 'sidebar-pinned';
        var THEME_KEY = 'theme';

        /* theme */
        var saved = localStorage.getItem(THEME_KEY);
        var theme = saved || (matchMedia('(prefers-color-scheme: light)').matches ? 'light' : 'dark');
        html.setAttribute('data-theme', theme);

        function toggleTheme() {
            var next = html.getAttribute('data-theme') === 'dark' ? 'light' : 'dark';
            html.setAttribute('data-theme', next);
            localStorage.setItem(THEME_KEY, next);
        }

        document.querySelectorAll('[data-theme-toggle]').forEach(function (btn) {
            btn.addEventListener('click', toggleTheme);
        });

        /* sidebar pin */
        if (localStorage.getItem(SIDEBAR_KEY) === '1') {
            body.classList.add('sidebar-pinned');
        }

        var pinBtn = document.querySelector('[data-pin-toggle]');
        if (pinBtn) {
            pinBtn.addEventListener('click', function () {
                body.classList.toggle('sidebar-pinned');
                localStorage.setItem(SIDEBAR_KEY, body.classList.contains('sidebar-pinned') ? '1' : '0');
            });
        }

        /* active nav highlight */
        var path = location.pathname;
        document.querySelectorAll('.sidebar-nav a[href]').forEach(function(a) {
            var href = a.getAttribute('href');
            if (!href || href === '#') return;
            var isActive = href === '/' ? path === '/' : path.startsWith(href);
            if (isActive) a.classList.add('active');
        });

        /* mobile menu */
        var mobileBtn = document.querySelector('[data-mobile-toggle]');
        var overlay = document.querySelector('[data-overlay]');

        function closeMobile() {
            body.classList.remove('mobile-open');
        }

        if (mobileBtn) {
            mobileBtn.addEventListener('click', function () {
                body.classList.toggle('mobile-open');
            });
        }
        if (overlay) {
            overlay.addEventListener('click', closeMobile);
        }
    })();
</script>
<script>
    (function () {
        var DISMISS_MS = 4000;
        var container = document.getElementById('toast-container');
        if (!container) return;

        function dismiss(toast) {
            if (toast.classList.contains('toast-out')) return;
            toast.classList.add('toast-out');
            toast.addEventListener('animationend', function () {
                toast.remove();
            });
        }

        container.querySelectorAll('.toast').forEach(function (toast) {
            toast.querySelector('.toast-close').addEventListener('click', function () {
                dismiss(toast);
            });
            setTimeout(function () {
                dismiss(toast);
            }, DISMISS_MS);
        });
    })();
</script>
</body>
</html>
